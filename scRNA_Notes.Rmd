---
title: "scRNA notes"
author: "liuc"
date: '2022-03-28'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## scRNA Notes

测序流程：现在主流的主要10X Genomics Chromium（较多细胞），SMART-seq2（较多基因）和Fluidigm C1等。当然还有其他的如：CELL-seq、Drop-seq、mas-seq和Wafergen ICELL8等.


10X用到的建库技术是微滴droplet-based 技术, 通过Poly(dT)与RNA 分子 3'端poly(A)尾巴互补配对以捕获 RNA分子.其下机fastq数据包括三个，分别是I1，R1，R2这三个文件，其中I1为index文件，
R1为Barcodes+UMI文件，R2是转录本3'端测序数据(测序长度为90？)。可以记成index标识样本、barcode标识细胞、UMI校准定量。
10X免疫组库建库一般会同时测V(D)J 区段的全长序列和5’端转录组。


*10X的测序样本数目和数据量: *一个样本100G的数据量，测大概10000个细胞，每个细胞可以测1000-2000左右的基因。


```{bash}

i='samplename'
time fastq-dump --gzip --split-files -A $i ${i}.sra && echo "** ${i}.sra to fastq done **"
```

### cellranger 的具体使用

cellrange 包装的较好

cellranger mkfastq ： 它借鉴了Illumina的bcl2fastq ，可以将一个或多个lane中的混样测序样本按照index标签生成样本对应的fastq文件

cellranger count ：利用mkfastq生成的fq文件，进行比对(基于STAR)、过滤、UMI计数。利用细胞的barcode生成gene-barcode矩阵，然后进行样本分群、基因表达分析

cellranger aggr ：接受cellranger count的输出数据， 将同一组的不同测序样本的表达矩阵整合在一起， 比如tumor组原来有4个样本，PBMC组有两个样本，现在可以使用aggr生成最后的tumor和PBMC两个矩阵，并且进行标准化去掉测序深度的影响

cellranger reanalyze ：接受cellranger count或cellranger aggr生成的gene-barcode矩阵，使用不同的参数进行降维、聚类

```{bash}

cellranger sitecheck #系统信息的整合

# 测试安装成功与否
/home/liuc/Software/cellranger-6.1.2/cellranger testrun --id=cellranger_test

# 参考序列下载
curl -O https://cf.10xgenomics.com/supp/cell-exp/refdata-gex-GRCh38-2020-A.tar.gz


```



## 几个疑问

1. 两分组设计时，需要几个重复
2. 重复样本怎么分析，怎么merge，DEGs分析时如何考虑重复样本


A: 对于生物学重复而言，单细胞测序不具备所谓的生物学重复，因为每一个细胞都是独特的，在分析中以一组细胞作为类似细胞。

在考虑批次和重复时，最好的建库方法为，不同处理的样本在同一批次中进行；单个样本可以在不同的区域进行取样等。

A: 对于每一个分组的重复, 可以有效的控制批次效应.if doing DE across conditions or making conclusions at the population level.


3. 数据整合后还需要质控吗？
一般在把多个数据merge后，会通过质控删掉一些cells和genes，然后进行integrate，那在integrate后需不需要进一步对数据进行质控呢？






